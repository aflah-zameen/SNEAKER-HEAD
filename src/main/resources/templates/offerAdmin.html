<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>SNEAKER HEAD - Offer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .active{
        background-color:blue;
        }
        .navbar-brand {
         font-weight: 600;
         color: black;
 font-family: 'Trirong',serif;
     }
     .sidebar {
         min-height: 100vh;
         border-right: 1px solid #dee2e6;
     }

     .sidebar .nav-link {
         color: #333;
         padding: 0.8rem 1rem;
         border-bottom: 1px solid #dee2e6;
     }

     .sidebar .nav-link:hover,
     .sidebar .nav-link.active {
         background-color: #f8f9fa;
     }

     .main-content {
         padding: 2rem;
     }

     .table-responsive {
         margin-top: 20px;
     }

     .status-badge {
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         font-size: 0.875rem;
     }

     .status-badge.list {
         background-color: #28a745;
         color: white;
     }

     .status-badge.unlist {
         background-color: #dc3545;
         color: white;
     }

     .search-box {
         max-width: 300px;
     }

     .logo {
         font-size: 1.5rem;
         font-weight: bold;
         padding: 1rem;
         border-bottom: 1px solid #dee2e6;
     }

     .file-upload {
         border: 2px dashed #dee2e6;
         padding: 20px;
         text-align: center;
         margin: 10px 0;
         cursor: pointer;
     }

     .uploaded-files {
         display: flex;
         gap: 10px;
         margin-top: 10px;
     }

     .uploaded-file {
         padding: 5px 10px;
         background: #f8f9fa;
         border-radius: 4px;
         display: flex;
         align-items: center;
         gap: 5px;
     }

        //search-box
        .search-box .form-control {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}

.search-box .btn-primary {
  border-radius: 0;
}

.search-box .btn-outline-secondary {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

@media (min-width: 576px) {
  .search-box .input-group {
    width: 400px;
  }
}


    </style>
</head>
<body>
<header class="navbar sticky-top bg-white flex-md-nowrap p-0 shadow " style="height: 3rem;">
    <span class="navbar-brand col-md-3 col-lg-2 me-0 px-3 position-absolute start-50  translate-middle fs-3"
          style="top:1.5rem;">SNEAKER HEAD</span>
    <button aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation"
            class="navbar-toggler position-absolute d-md-none collapsed" data-bs-target="#sidebarMenu"
            data-bs-toggle="collapse"
            type="button">
        <span class="navbar-toggler-icon"></span>
    </button>
</header>

<div class="container-fluid position-relative">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 px-0 sidebar">
            <nav class="nav flex-column">
                <a class="nav-link" href="/admin/dashboard">Dashboard</a>
                <a class="nav-link" href="/admin/orders">Orders</a>
                <a class="nav-link active" href="/admin/product">Products</a>
                <a class="nav-link" href="/admin/users">Users</a>
                <a class="nav-link" href="/admin/category">Categories</a>
                <a class="nav-link" href="/admin/brands">Brands</a>
                <a class="nav-link" href="/admin/coupons">Coupons</a>
                <a class="nav-link" href="/admin/banners">Banners</a>
                <a class="nav-link" href="/admin/payments">Payments</a>
                <a class="nav-link" href="/admin/sales">Sales report</a>

                <a class="nav-link" href="/admin/offers">Offers</a>
                <button
                        class="btn btn-danger mt-3"
                        onclick="window.location.href='/logout'"
                        style="width: 100%; text-align: center; background-color: #dc3545; color: white; border: none; padding: 10px; font-size: 16px; cursor: pointer;">
                    Logout
                </button>
            </nav>
        </div>
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center my-4">
                <h2 class="mb-0">Offer</h2>

                <!-- Search Bar -->
                <div class="input-group" style="max-width: 400px;">
                    <input type="text" class="form-control form-control-sm" placeholder="Search" id="searchInput">
                    <button class="btn btn-primary btn-sm" type="button" onclick="search()">Search</button>
                    <button class="btn btn-secondary btn-sm" type="button" onclick="clearSearch()">Clear</button>
                </div>

                <!-- Add Coupon Button -->
                <button class="btn btn-primary btn-sm" onclick="window.location.href='/admin/offer/addoffer'">
                    + Add Offer
                </button>
            </div>

            <!-- Coupon Table -->
            <div class="table-responsive ps-5 pe-5">
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th class="sortable">
                            ID
                            <button class="btn  p-0" onclick="sort(this,'id', 'ASC')">
                                <i class="bi bi-arrow-up "></i>
                            </button>
                            <button class="btn  p-0" onclick="sort(this,'id', 'DESC')">
                                <i class="bi bi-arrow-down"></i>
                            </button>
                        </th>
                        <th class="sortable">
                            Offer name
                            <button class="btn  p-0" onclick="sort(this,'offerName', 'ASC')">
                                <i class="bi bi-arrow-up"></i>
                            </button>
                            <button class="btn  p-0" onclick="sort(this,'offerName', 'DESC')">
                                <i class="bi bi-arrow-down"></i>
                            </button>
                        </th>
                        <th class="sortable">
                            Offer Percentage
                            <button class="btn  p-0" onclick="sort(this,'discountValue', 'ASC')">
                                <i class="bi bi-arrow-up"></i>
                            </button>
                            <button class="btn  p-0" onclick="sort(this,'discountValue', 'DESC')">
                                <i class="bi bi-arrow-down"></i>
                            </button>
                        </th>
                        <th class="sortable">
                            Applied on
                        </th>
                        <th class="sortable">
                            Expiry Date
                            <button class="btn  p-0" onclick="sort(this,'endDate', 'ASC')">
                                <i class="bi bi-arrow-up"></i>
                            </button>
                            <button class="btn  p-0" onclick="sort(this,'endDate', 'DESC')">
                                <i class="bi bi-arrow-down"></i>
                            </button>
                        </th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody th:if="${offers}" id="offer-table-body">
                    <tr th:each="offer : ${offers}">
                        <td th:text="${offer.id}"></td>
                        <td th:text="${offer.offerName}"></td>
                        <td th:text="${offer.discountValue}"></td>
                        <td th:if="${offer.type}" th:text="${offer.type == 'product' ? 'Product-ID :'+offer.typeId : 'Category-ID : '+offer.typeId}"></td>
                        <td th:text="${offer.endDate}"></td>
                        <td>
                            <button class="btn btn-sm btn-danger"
                                    th:onclick="|window.location.href='/admin/offer/remove/' + ${offer.id}|">
                                    Remove
                            </button>
                            <button class="btn btn-sm "
                                    th:onclick="|window.location.href='/admin/offer/edit/' + ${offer.id}|">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" class="my-3" id="paginationElement" th:if="${totalPages > 1}">
                <ul class="pagination justify-content-center">
<!--                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">-->
<!--                        <a class="page-link" href="#" th:onclick="'goToPage(' + (${currentPage} - 1) + ');'">&laquo;</a>-->
<!--                    </li>-->
                    <li class="page-item" th:each="page : ${#numbers.sequence(1, totalPages)}"  >
                        <a class="page-link" th:classappend="${page == 1} ? 'active'" href="#" th:onclick="'goToPage(this,' + ${page} + ');'" th:text="${page}"></a>
                    </li>
<!--                    <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">-->
<!--                        <a class="page-link" href="#" th:onclick="'goToPage(' + (${currentPage} + 1) + ');'">&raquo;</a>-->
<!--                    </li>-->
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Add Coupon Modal -->
<!--<div class="modal fade" id="addCouponModal" tabindex="-1">-->
<!--    <div class="modal-dialog modal-lg">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h5 class="modal-title">Add Coupon</h5>-->
<!--                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <form id="addCouponForm">-->
<!--                    <div class="mb-3">-->
<!--                        <label class="form-label">Coupon Name</label>-->
<!--                        <input type="text" class="form-control" required>-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label class="form-label">Description</label>-->
<!--                        <textarea class="form-control" rows="3"></textarea>-->
<!--                    </div>-->
<!--                    <div class="row mb-3">-->
<!--                        <div class="col-md-4">-->
<!--                            <label class="form-label">Color</label>-->
<!--                            <input type="text" class="form-control">-->
<!--                        </div>-->
<!--                        <div class="col-md-4">-->
<!--                            <label class="form-label">Brand</label>-->
<!--                            <input type="text" class="form-control">-->
<!--                        </div>-->
<!--                        <div class="col-md-4">-->
<!--                            <label class="form-label">Category</label>-->
<!--                            <input type="text" class="form-control">-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="row mb-3">-->
<!--                        <div class="col-md-6">-->
<!--                            <label class="form-label">Price</label>-->
<!--                            <input type="number" class="form-control">-->
<!--                        </div>-->
<!--                        <div class="col-md-6">-->
<!--                            <label class="form-label">Quantity</label>-->
<!--                            <input type="number" class="form-control">-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label class="form-label">Coupon Images</label>-->
<!--                        <div class="file-upload">-->
<!--                            <input type="file" class="d-none" id="productImages" multiple accept="image/*">-->
<!--                            <label for="productImages" class="mb-0">-->
<!--                                Choose Files or Drag & Drop-->
<!--                            </label>-->
<!--                        </div>-->
<!--                        <div class="uploaded-files" id="uploadedFiles">-->
<!--                            &lt;!&ndash; Uploaded files will be shown here &ndash;&gt;-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </form>-->
<!--            </div>-->
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>-->
<!--                <button type="button" class="btn btn-primary">Add Coupon</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>


<!--    function updateStatus(data)-->
<!--    {-->
<!--        const status= data.getAttribute("data-current-status") == "true" ? true : false;-->
<!--        const productId = parseInt(data.getAttribute("data-product-id"));-->
<!--        fetch(`/admin/product/status?status=${status}&productId=${productId}`,{-->
<!--            method : 'PUT',-->
<!--        })-->
<!--        .then(response => {-->
<!--            if(response.ok)-->
<!--            {-->
<!--                 Swal.fire({-->
<!--                                icon: "success",-->
<!--                                title: "Success",-->
<!--                                text: "Coupon status updated!",-->
<!--                                confirmButtonText: "OK",-->
<!--                                allowOutsideClick: false,-->
<!--                            });-->
<!--                  data.textContent = status ? "List" : "Unlist";-->
<!--                  data.classList.remove( status ? "btn-danger" : "btn-success");-->
<!--                  data.classList.add(status ? "btn-success" : "btn-danger");-->
<!--                  data.setAttribute("data-current-status", status ? false : true);-->
<!--            }-->
<!--            else-->
<!--            {-->
<!--                 Swal.fire({-->
<!--                    icon: "error",-->
<!--                    title: "Error",-->
<!--                    text: "Some issues while updating status",-->
<!--                    confirmButtonText: "OK",-->
<!--                    allowOutsideClick: false,-->
<!--                });-->

<!--            }-->
<!--        })-->
<!--        .catch(error => {-->
<!--        // Handle network errors or other unexpected issues-->
<!--        Swal.fire({-->
<!--            icon: "error",-->
<!--            title: "Error",-->
<!--            text: "An unexpected error occurred. Please try again.",-->
<!--            confirmButtonText: "OK",-->
<!--            allowOutsideClick: false,-->
<!--        });-->
<!--    });-->
<!--    }-->



    //sorting and pagination
    let pageNumber = 0;
    let sortBy ="id";
    let orderType ="ASC";
    function goToPage(data,page) {
       const pageElements = document.querySelectorAll('.page-link');
       pageElements.forEach(element => {
       element.classList.remove("active");
       });
       data.classList.add("active");
       pageNumber = Number(page)-1;
       paginationSorting();
    }
    function sort(data,sort,order)
    {

    const iconElements = data.closest('tr').querySelectorAll('.bi');
       iconElements.forEach(element => {
       element.classList.remove("text-danger");
       });
       data.querySelector('.bi').classList.add('text-danger');
        sortBy =sort;
        orderType = order;
         paginationSorting();
    }
    function paginationSorting()
    {

        const formData = {
        sortBy : sortBy,
        order : orderType,
        pageNumber : pageNumber
        };

        console.log(formData);

        fetch('/admin/offers/sorting',{
            method: 'POST',
            headers : {"Content-Type" : "application/json"},
            body : JSON.stringify(formData)
        })
        .then(response => response.json())
        .then( data => {
        console.log(data);
        populateTable(data);
        })
        .catch(error => console.error('Error fetching products:', error));

        }

    //populate data
     function populateTable(offers) {
        const tbody = document.getElementById('offer-table-body');
        tbody.innerHTML = '';  // Clear existing rows

        offers.forEach(offer => {
            console.log(offer);
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${offer.id}</td>
                <td>${offer.offerName}</td>
                <td>${offer.discountValue}</td>
                <td>${offer.categoryName ? `Category: ${offer.categoryName}` : `Product: ${offer.productName}`}</td>
                <td>${offer.endDate}</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="window.location.href='/admin/offer/remove/${offer.id}' "
                            >
                            Remove
                    </button>
                    <button class="btn btn-sm btn-link" onclick="window.location.href='/admin/offer/edit/${offer.id}'">
                        <i class="bi bi-pencil"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function search()
    {
        const keyword = document.getElementById('searchInput').value.trim();
        console.log(keyword);
        if(keyword !="" && keyword != null )
        {
        fetch(`/admin/offers/search?keyword=${keyword}`,{
            method:'GET'
        })
        .then(response => response.json())
        .then(data => { populateTable(data);
                document.getElementById('paginationElement').classList.add('d-none');})
        .catch(error => console.error('Error fetching products:', error));
        }

    }

    function clearSearch()
    {
         pageNumber = 0;
         sortBy ="id";
         orderType ="ASC";
        paginationSorting();
        document.getElementById('paginationElement').classList.remove('d-none');
        document.getElementById('searchInput').value = "";
    }
</script>

</body>
</html>